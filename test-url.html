<!DOCTYPE html>
<html>
<head>
    <title>URL Test</title>
</head>
<body>
    <h1>Testing URL Formatting</h1>
    <div id="result"></div>

    <script>
        // Copy of your formatDropboxUrl function
        function formatDropboxUrl(url) {
            // Check if URL is empty or invalid
            if (!url || url.trim() === '') {
                console.warn("Empty URL provided to formatDropboxUrl");
                return '';
            }
            
            try {
                // Just try to create a URL object to validate it
                new URL(url);
            } catch(e) {
                console.error("Invalid URL format:", url, e);
                return url; // Return original to prevent further issues
            }
            
            // Replace www.dropbox.com with dl.dropboxusercontent.com
            var formattedUrl = url.replace('www.dropbox.com', 'dl.dropboxusercontent.com');
            
            // Replace dl=0 with raw=1
            formattedUrl = formattedUrl.replace('dl=0', 'raw=1');
            
            // Add raw=1 if it's not there
            if (!formattedUrl.includes('?')) {
                formattedUrl += '?raw=1';
            } else if (!formattedUrl.includes('raw=1')) {
                formattedUrl += '&raw=1';
            }
            
            return formattedUrl;
        }

        // Test URLs
        const testUrls = [
            "https://www.dropbox.com/s/12345/teachable-integration.js",
            "https://www.dropbox.com/s/12345/teachable-integration.js?dl=0",
            "https://dl.dropboxusercontent.com/s/12345/teachable-integration.js",
            "https://dl.dropboxusercontent.com/scl/fi/12345/teachable-integration.js?rlkey=abc123",
            ""  // Empty test
        ];

        // Display results
        const resultDiv = document.getElementById('result');
        let html = "<h2>Test Results:</h2>";

        for (const url of testUrls) {
            html += "<div style='margin-bottom: 20px; padding: 10px; border: 1px solid #ccc;'>";
            html += "<p><strong>Original:</strong> " + (url || "(empty string)") + "</p>";
            
            const formatted = formatDropboxUrl(url);
            html += "<p><strong>Formatted:</strong> " + formatted + "</p>";
            
            // Generate script tag
            const scriptTag = "<script src=\"" + formatted + "\"><\/script>";
            html += "<p><strong>Script Tag:</strong> " + scriptTag.replace(/</g, "&lt;").replace(/>/g, "&gt;") + "</p>";
            html += "</div>";
        }

        resultDiv.innerHTML = html;
    </script>
</body>
</html>
