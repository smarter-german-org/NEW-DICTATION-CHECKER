<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Direct GitHub Integration Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        h1 {
            color: #0366d6;
        }
        .container {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .test-description {
            background-color: #f6f8fa;
            padding: 10px;
            border-left: 4px solid #0366d6;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <h1>Dictation Checker Integration Test</h1>
    
    <div class="test-description">
        <p>This file tests the dictation checker by directly loading files from Dropbox and the integration script.</p>
    </div>
    
    <!-- Test with Dropbox hosted audio/vtt -->
    <div class="container">
        <h2>Test with Dropbox Hosted Media</h2>
        <!-- Dictation Exercise Container -->
        <div class="dictation-app-container" 
             data-course-id="TestCourse" 
             data-lesson-id="L01" 
             data-audio-url="https://dl.dropboxusercontent.com/scl/fi/none-yet/test-audio.mp3?raw=1"
             data-vtt-url="https://dl.dropboxusercontent.com/scl/fi/none-yet/test-audio.vtt?raw=1">
        </div>
    </div>
    
    <!-- Teachable Integration Script - Using direct integration.js file from the repo -->
    <script>
        // Configuration for the dictation app
        window.DICTATION_APP_CONFIG = {
            // Log debug messages to console
            debug: true,
            // Override assets path if needed
            assetsPath: '.'
        };
    </script>
    
    <script>
    (function() {
      // Automatically detect the app location from the script source or provide fallback
      const appBaseUrl = (function() {
        try {
          // Get the current script tag
          const scripts = document.getElementsByTagName('script');
          const currentScript = scripts[scripts.length - 1];
          const scriptSrc = currentScript.src;
          
          // Extract the base URL from the script source
          const autoDetectedUrl = scriptSrc.substring(0, scriptSrc.lastIndexOf('/'));
          
          // If autodetection works, use that URL
          if (autoDetectedUrl && autoDetectedUrl.length > 0) {
            console.log('Dictation App: Using auto-detected URL:', autoDetectedUrl);
            return autoDetectedUrl;
          }
        } catch (e) {
          console.warn('Dictation App: Auto-detection failed, using local files');
        }
        
        // Fallback to local files
        return '.';
      })();
      
      // Wait for DOM to be fully loaded
      document.addEventListener('DOMContentLoaded', function() {
        // Find all dictation app containers
        const containers = document.querySelectorAll('.dictation-app-container');
        
        if (containers.length === 0) {
          console.log('Dictation App: No container elements found. Add a div with class "dictation-app-container"');
          return;
        }
        
        // Process each container
        containers.forEach(function(container, index) {
          // Get configuration from data attributes
          const courseId = container.getAttribute('data-course-id');
          const lessonId = container.getAttribute('data-lesson-id');
          const audioUrl = container.getAttribute('data-audio-url');
          const vttUrl = container.getAttribute('data-vtt-url');
          
          // Validate required attributes
          if (!audioUrl || !vttUrl) {
            container.innerHTML = `
              <div style="padding: 20px; border: 2px solid #f44336; background-color: #ffebee; color: #b71c1c;">
                <h3>Dictation App Configuration Error</h3>
                <p>Missing required attributes: data-audio-url and data-vtt-url must be specified.</p>
              </div>
            `;
            return;
          }
          
          // Generate a unique ID for this container
          const containerId = 'dictation-embed-' + (index + 1);
          container.id = containerId;
          
          // Display the configuration for debugging
          container.innerHTML = `
            <div style="padding: 15px; background-color: #e8f5e9; border: 1px solid #c8e6c9; margin-bottom: 20px;">
              <h3>Integration Test Details</h3>
              <p><strong>Course ID:</strong> ${courseId || 'Not specified'}</p>
              <p><strong>Lesson ID:</strong> ${lessonId || 'Not specified'}</p>
              <p><strong>Audio URL:</strong> ${audioUrl}</p>
              <p><strong>VTT URL:</strong> ${vttUrl}</p>
              <p><strong>Container ID:</strong> ${containerId}</p>
            </div>
          `;
        });
        
        // Add the needed CSS for the containers
        const style = document.createElement('style');
        style.textContent = `
          .dictation-app-container {
            margin: 20px 0;
            width: 100%;
            max-width: 900px;
          }
        `;
        document.head.appendChild(style);
      });
    })();
    </script>
</body>
</html>
